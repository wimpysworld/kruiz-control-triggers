# b - Broadcaster
# s - Subscriber
# f - Follower
# o - Founder
# v - VIP
# m - Moderator
# n - Check if a user has none of the permissions above.
# e - Everyone

# TODO
#  - Play a clip from raiders

OnInit
    Variable Set FirstUser " "
    Variable Set FirstMessage " "
    Variable Set "TwitchID" "WimpysWorld"
    Variable Set "TwitchBot" "BellaBotty"
    Variable Set MessageCount 0
    Message Send CreateChatTimers
    Timer Start ChatTimers

OnOBSStreamStarted
    Variable Load FirstUser
    Variable Load FirstMessage
    Variable Load MessageCount
    Variable Set FirstUser " "
    Variable Set FirstMessage " "
    Variable Set MessageCount 0

OnEveryChatMessage
    # Ignore the broadcast and their bot from !first and chat activity.
    Variable Load TwitchID
    Variable Load TwitchBot
    # Ignore broadcasters and bots
    If 1 "{user}" = "{TwitchID}" or "{user}" = "{TwitchBot}"
        Exit
    # Ignore commands
    Function 'return {is_command: [message].trim().startsWith("!")}'
    If 1 {is_command} = "true"
        Exit
    # Increment the chat message counter
    Variable Load MessageCount
    Param Add MessageCount 1
    Variable Set MessageCount {MessageCount}
    # Who is first?
    Variable Load FirstUser
    Variable Load FirstMessage
    If 1 {FirstUser} != " "
        Exit
    Variable Set FirstUser {user}
    Variable Set FirstMessage {message}

OnCommand e 10 !first
    Variable Load FirstUser
    Variable Load FirstMessage
    if 2 {user} = {FirstUser}
        Chat Send "You did it {user} ğŸ† You were first ğŸ¥‡ to talk in chat today!"
        Exit
    if 2 {FirstUser} != " "
        Chat Send "Nope {user}! You were too slow off the mark ğŸ¢ {FirstUser} was first in chat today ğŸ† and they said this: {FirstMessage}"
        Exit

## Interactive

OnCommand e 10 !accountage
    API Get "https://decapi.me/twitch/accountage/{user}"
    Variable Set accountage {api_data}
    Chat Send "{user} was created {accountage} ago."

OnCommand e 120 !chelsea-cucumber !chelseacucumber !mate
    Chat Send "Chelsea Cucumber ğŸ¥’ is the colour of our banner! #87A556 is the primary accent colour for the premiere Linux ğŸ§ distribution, Ubuntu MATE ğŸ§‰ - https://ubuntu-mate.org"
    Delay 2
    Chat Send "Hmmm, the color of my banner is #F917A7"

#OnCommand e 120 !theme
#    Chat Send "Wimpy uses the Yaru MATE theme of course! Derived from the fine Yaru theme ğŸ¨  for Ubuntu, which is better than a Burrito ğŸŒ¯ https://github.com/ubuntu/yaru"

OnCommand e 0 !floss
    Random Number 1 100
    if 1 {user} = "WimpysWorld"
        Random Number 90 100
    Chat Send "{user} is built from {number}% open source ğŸ’¾"
    Delay 2
    Chat Send "I am built entirely from open source ğŸ¦¾ https://github.com/wimpysworld/kruiz-control-triggers"

OnCommand e 10 !followage !howlong !followtime
    API Get https://decapi.me/twitch/followage/wimpysworld/{user}
    Chat Send "{user} has been following Wimpy's World for {api_data}. I know, we should send help ğŸš‘"

OnCommand e 300 !followers
    Variable Load TwitchFollowCount
    Chat Send "There are currently {TwitchFollowCount} followers ğŸ™‡ Validate Wimpy's existence and follow him."

OnCommand e 300 !viewercount !viewers
    Variable Load TwitchViewerCount
    Chat Send "Right now there are {TwitchViewerCount} viewers watching this stream ğŸ‘€ Tell your friends and lovers to come and join us ğŸ˜˜"

OnCommand e 300 !totalviews !allviews
    Variable Load TwitchTotalViews
    Chat Send "This channel has had {TwitchTotalViews} total views ğŸ“ˆ I know, it's a pointless vanity metric ğŸ’„"

OnCommand e 120 !os !distro
    Chat Send "Wimpy runs the sublime NixOS â„ï¸ BTW. And also the mighty ğŸ’ª Ubuntu MATE! A community-developed, Ubuntu-based operating system that beautifully integrates the MATE desktop ğŸ§‰ https://ubuntu-mate.org"

OnCommand e 120 !job !newjob
    Chat Send "Wimpy works at Determinate Systems as Developer Relations Engineer ğŸ§‘â€ğŸ’» and is helping make Nix easier â„ https://determinate.systems"

OnCommand e 15 !quote !techquote !tech-quote
    API Get "https://api.quotable.io/random?tags=technology"
    Function 'return {content: [api_data].content, author: [api_data].author}'
    Chat Send "Allegedly {author} once said '{content}' ğŸ¤” It must be true because an AI ğŸ¤–ğŸ§  on the Internet told me ğŸ¤¥"

OnCommand e 120 !game !stream !sup !waddup !wtfisgoingon
    Variable Load TwitchTitle
    Variable Load TwitchGame
    Variable Load TwitchViewerCount
    if 2 {TwitchGame} = "Software and Game Development"
        Chat Send "Wimpy is struggling with some {TwitchGame}. Thankfully {TwitchViewerCount} experts ğŸ¤“ are here to help â›‘ Specifically, we're having a go at {TwitchTitle}"
        Exit
    if 2 {TwitchGame} = "Retro"
        Chat Send "Wimpy is reliving his misspent youth ğŸ‘¶ and demonstrating how reaction times diminish as you age by badly playing ğŸ•¹ {TwitchGame} in front of {TwitchViewerCount} bewildered ğŸ˜• onlookers. We call this madness {TwitchTitle}"
        Exit
    Chat Send "Wimpy is playing {TwitchGame} badly ğŸ® in front of {TwitchViewerCount} members of our international all-star cast of cabaret artists ğŸ’ƒğŸ•º We're calling this disaster {TwitchTitle}"

OnCommand e 300 !subs !sub !prime !freesub
    Variable Load TwitchSubCount
    Variable Load TwitchSubEmotes
    OBS SceneSource "[O] Alerts" "CTA Prime" on
    Chat Send "This channel currently has {TwitchSubCount} subscribers ğŸ«¶ Click here to sub ğŸ‘‰ https://www.twitch.tv/subs/WimpysWorld/"
    Delay 6
    OBS SceneSource "[O] Alerts" "CTA Prime" off
    Chat Send "Use your Amazon Prime free sub ğŸ¤‘ to get this stream advert free and access to these fugly emotes {TwitchSubEmotes}"

OnCommand e 120 !uptime
    Variable Load TwitchUptime
    Chat Send "Wimpy has been at this nonsense for {TwitchUptime} ğŸ¤¦"

OnCommand e 300 !latestvideo !latest
    Variable Load TwitchVideos
    Variable Load YouTubeLatestVideo
    Chat Send "Wimpy's most recent public humiliation on YouTube is {YouTubeLatestVideo} and from Twitch there is this travesty {TwitchVideos}"

## Commands

OnCommand e 180 !music !spotify !nowplaying !playing !song !beats !streambeats
    OBS SceneSource "[O] Stats" "Now Playing" on
    Delay 5
    Chat Send "All the music ğŸ¶ we play is from StreamBeats https://streambeats.com"
    Delay 5
    OBS SceneSource "[O] Stats" "Now Playing" off

OnCommand e 300 !twitchstats !chatstats !stats
    Variable Load TwitchFollowCount
    Variable Load TwitchSubCount
    Variable Load TwitchTotalViews
    Variable Load TwitchUptime
    Variable Load TwitchViewerCount
    Chat Send "Wimpy has been streaming for {TwitchUptime} minutes and we currently have {TwitchViewerCount} viewers. The channel has {TwitchFollowCount} followers, {TwitchSubCount} subscribers and has been viewed {TwitchTotalViews} times. You can get chat metrics here https://stats.streamelements.com/c/wimpysworld"

## Projects

OnCommand e 300 !deb-get !debget !get-deb !getdeb
    Chat Send "apt-get functionality for .debs published in 3rd party repositories or via direct download ğŸ“¦ https://github.com/wimpysworld/deb-get"

OnCommand e 300 !quickemu !qemu
    Chat Send "Quickly create and run optimised Windows ğŸªŸ macOS ğŸ and Linux ğŸ§ virtual machines - https://github.com/quickemu-project"

OnCommand e 300 !retro-home !retrohome
    Chat Send "Your home for retro-gaming ğŸ•¹ https://github.com/wimpysworld/retro-home"

OnCommand e 300 !ubuntu-mate !ubuntumate
    Chat Send "A community-developed, Ubuntu-based operating system that beautifully integrates the MATE desktop ğŸ§‰ https://ubuntu-mate.org"

OnCommand e 300 !obs !obs-studio !obs-studio-portable !obs-portable
    Chat Send "OBS Studio Portable builds for Ubuntu. Over 50 plugins included ğŸ“¡ https://github.com/wimpysworld/obs-studio-portable"

OnCommand e 300 !podcast !linuxmatters !linux-matters
    Chat Send "Wimpy is a co-host on the Linux Matters ğŸ§ğŸ’¬ podcast ğŸ™ï¸ Three open-source professionals discuss how Linux impacts their daily lives and all the Linux Matters that matter! https://linuxmatters.sh"

OnCommand e 300 !8bitversus !8bitvs !8bvs
    Chat Send "Do you like a bit of retro ğŸ•¹ï¸ gaming? Check out 8-Bit Versus, where @popeydc and @WimpysWorld go head to head on ZX Spectrum and C64 ğŸ¥Š https://8bitversus.com"

## Tools

OnCommand e 300 !streamdeck !stream-deck !deck
    Chat Send "Configuration tool for the StreamDeck ğŸ› devices that works on Linux ğŸ§ https://github.com/muesli/deckmaster"

OnCommand e 300 !kruizcontrol !kruiz-control !kruiz !kc
    Chat Send "Automate OBS Studio, create chat bots, integrate with Twitch, StreamElements alerts and Discord all using pseudo code ğŸ§‘â€ğŸ’» https://github.com/Kruiser8/Kruiz-Control"

## Socials

OnCommand e 300 !discord
    Chat Send "Join other Linux ğŸ§ enthusiasts in Wimpy's World Discord ğŸ’¬ https://wimpysworld.io/discord"
    OBS SceneSource "[O] Alerts" "CTA Discord" on
    Delay 7
    OBS SceneSource "[O] Alerts" "CTA Discord" off

OnCommand e 300 !github !gh !code
    Chat Send "Our projects are on GitHub ğŸ™ https://wimpysworld.io/github"

OnCommand e 300 !instagram
    Chat Send "Previews of upcoming projects on Instagram ğŸ“¸ https://wimpysworld.io/instagram"
    OBS SceneSource "[O] Alerts" "CTA Instagram" on
    Delay 6
    OBS SceneSource "[O] Alerts" "CTA Instagram" off

OnCommand e 300 !insta
    Chat Send "Behind the scenes previews on Instagram ğŸ“¸ https://wimpysworld.io/instagram"
    OBS SceneSource "[O] Alerts" "CTA Insta" on
    Delay 6
    OBS SceneSource "[O] Alerts" "CTA Insta" off

OnCommand e 300 !kit !gear !setup !keyboard
    Chat Send "Kit lists of the Linux ğŸ§ compatible gear Wimpy uses https://wimpysworld.io/kit"

OnCommand e 300 !telegram !tg
    Chat Send "Get go-live notifications ğŸ“¡ and status updates via Telegram ğŸ“² https://wimpysworld.io/telegram"

OnCommand e 300 !twitch
    Chat Send "Streams of live coding ğŸ§‘â€ğŸ’» for various projects on Twitch ğŸ“¡ https://wimpysworld.io/twitch"
    OBS SceneSource "[O] Alerts" "CTA Twitch" on
    Delay 6
    OBS SceneSource "[O] Alerts" "CTA Twitch" off

OnCommand e 300 !twitter !tweet !spacekaren
    Chat Send "Follow Wimpy on Twitter ğŸ¦ https://wimpysworld.io/twitter"

OnCommand e 300 !mastodon !masto !toot !melontusk
    Chat Send "Follow Wimpy on Mastodon ğŸ¦£ https://wimpysworld.io/mastodon"

OnCommand e 300 !youtube !yt
    Chat Send "Subscribe to Wimpy's YouTube ğŸ“º channel for Linux development and fun projects https://wimpysworld.io/youtube"
    OBS SceneSource "[O] Alerts" "CTA YouTube" on
    Delay 6
    OBS SceneSource "[O] Alerts" "CTA YouTube" off
    Variable Load YouTubeLatestVideo
    Chat Send "Here's the most recent video on YouTube: {YouTubeLatestVideo}"

OnCommand e 300 !website !socials !links
    Chat Send "Here's Wimpy's website with a blog and links to stalk him in all the usual places ğŸ¯ https://wimpysworld.com"

OnCommand e 300 !schedule
    Chat Send "The stream schedule is available here ğŸ—“ https://www.twitch.tv/wimpysworld/schedule"

OnCommand e 300 !giveaway !giveaways
    Chat Send "You freeloader! There are no giveaways here {user} ğŸ¤£"

OnCommand e 60 !commands !man !help
    Chat Send "Remind @WimpysWorld that he needs to document the commands available here! ğŸ‘¿"

OnCommand e 60 !rules
    Chat Send "ğŸ¤ Be respectful â›‘ Be helpful ğŸ¤“ Be interesting ğŸ¤£ Be funny ğŸ›  Be creative ğŸ™‡ Be polite ğŸ–– Be excellent to each other â›” No spam"

OnCommand e 10 !lurk
    Chat Send "{user} thanks for letting me know you're quietly lurking in the channel ğŸ¤«"

OnCommand e 120 !settings !specs
    Chat Send "Everything is turned up to 11 ğŸ› That's how we roll around here {user} ğŸ’ª"
    Delay 1.5
    Chat Send "@{user} you can see the Linux ğŸ§ compatible gear here ğŸ‘‰ https://wimpysworld.io/kit"

OnCommand e 120 !8ball !8-ball
    Chat Send "ğŸ± Wait for it {user}..."
    Delay 5
    Chat Send "Hey @{user} are you still waiting for the 8 Ball? I got bored and killed the process ğŸ”ªğŸ©¸ #sorry #notsorry"

OnCommand e 120 !tip !donate
    Chat Send "The tip jar is here ğŸ’° https://wimpysworld.io/tip"

OnCommand e 120 !obs
    OBS Version
    Variable Set WebsocketVersion {version}
    OBS Stats
    Chat Send "OK nerd ğŸ¤“ OBS Studio is running Websockets {WebsocketVersion} and using {cpu}% CPU, {memory}MB RAM with {disk_space}MB disk available. Currently rendering {fps} FPS with each frame taking an average of {average_render_time}ms to render ğŸ“Š"

OnCommand e 60 !botsnack
    Play 100 nowait botsnack.mp3
    Chat Send "Nom nom nom ğŸª"
    Delay 1
    Chat Send "Have a hug {user} ğŸ¤—"

OnCommand e 0 !badbot !badbella
    Chat Send "Oh reallyâ‰ ğŸ˜²"
    Random Number 15 45
    Chat Send "Timeout for {user}! Go ğŸ‘‰ï¸ and sit on the naughty step ğŸ˜¤ for {number} seconds â²"
    Twitch Timeout {user} {number}

# Chat Timers

OnMessage CreateChatTimers
    Variable Load TwitchFollowCount
    Variable Load TwitchSubEmotes
    List Add ChatTimers "Enjoying the stream? Hit that follow button to show your support and join {TwitchFollowCount} Linux ğŸ§ Lovers ğŸ’–"
    List Add ChatTimers "Follow Wimpy on Mastodon ğŸ¦£ https://wimpysworld.io/mastodon"
    List Add ChatTimers "Join Wimpy's World Discord ğŸ—£ï¸ for more Linux ğŸ§chat about development, desktop, gaming, streaming and making https://wimpysworld.io/discord"
    List Add ChatTimers "Use your Amazon Prime free sub ğŸ¤‘ to get this stream advert free and access to these fugly emotes {TwitchSubEmotes}"
    List Add ChatTimers "Follow Wimpy on Twitter ğŸ¦ https://wimpysworld.io/twitter"
    List Add ChatTimers "Curious what Linux ğŸ§ compatible hardware Wimpy uses for streaming? Here's the kit list ğŸ“ https://wimpysworld.io/kit"
    List Add ChatTimers "Subscribe to Wimpy's YouTube ğŸ“º channel for an archive of these live streams and other fun Linux ğŸ§ projects https://wimpysworld.io/youtube"
    List Add ChatTimers "Get sneak ğŸ•µ previews of upcoming projects on Wimpy's Instagram ğŸ“¸ https://wimpysworld.io/instagram"
    List Add ChatTimers "Follow Wimpy's World on GitHub ğŸ™ for all our projects https://wimpysworld.io/github"
    List Add ChatTimers "Wimpys's blog and ways to get connected are on the website ğŸŒ https://wimpysworld.com"
    #List Add ChatTimers "Get notified ğŸ“« about new streams and videos via Telegram https://wimpysworld.io/telegram"

# Post the timed chat every 15mins, but after 5mins start delay
OnTimer ChatTimers 900 300
    # If stream appears offline, do not spam chat
    Variable Load TwitchUptime
    If 1 {TwitchUptime} = 0
        Exit
    Variable Load MessageCount
    # If chat is too quiet, do not spam chat
    If 1 {MessageCount} < 10
        Exit
    Variable Set MessageCount 0
    List Remove ChatTimers First
    Chat Send {value}
    List Count ChatTimers
    If 1 {count} = 0
        Message Send CreateChatTimers
